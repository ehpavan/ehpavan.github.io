<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog | Pavan</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
/* Default dark theme */
body {
  background-color: #000;
  color: #fff;
  transition: background-color 0.4s ease, color 0.4s ease;
}

/* Light theme */
body.light {
  background-color: #fff;
  color: #000;
}

/* Navbar */
nav {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 20px;
}
nav a {
  color: inherit;
  text-decoration: none;
  font-weight: 500;
}
nav a:hover {
  opacity: 0.8;
}

/* Theme toggle button */
.theme-toggle {
  cursor: pointer;
  border: none;
  background: none;
  color: inherit;
  font-size: 1.4rem;
  transition: transform 0.3s ease;
}
.theme-toggle:hover {
  transform: rotate(20deg);
}

/* Plain code blocks */
pre, pre code {
  background-color: transparent;
  color: inherit;
  padding: 10px;
  border-radius: 5px;
  overflow-x: auto;
  display: block;
  font-family: monospace;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Fade-in animation for blog content */
.blog-content {
  transition: opacity 0.5s ease, transform 0.5s ease;
  opacity: 0;
  transform: translateY(20px);
}
.blog-content.visible {
  opacity: 1;
  transform: translateY(0);
}

/* Meta info */
.blog-meta {
  font-size: 0.95rem;
  color: #888;
  margin-bottom: 12px;
  font-style: normal;
  font-weight: 500;
}
body.light .blog-meta {
  color: #555;
}
</style>
</head>
<body>
<nav>
  <a href="index.html">‚Üê Back to Blogs</a>
  <button class="theme-toggle" id="theme-toggle" title="Toggle theme">üåô</button>
</nav>

<div class="blog-content" id="blog-content">
  <h2>Loading blog...</h2>
</div>

<script>
// --- THEME TOGGLE SYSTEM ---
const themeToggle = document.getElementById("theme-toggle");
const savedTheme = localStorage.getItem("theme");

// Apply saved theme
if (savedTheme === "light") {
  document.body.classList.add("light");
  themeToggle.textContent = "‚òÄÔ∏è";
} else {
  themeToggle.textContent = "üåô";
}

// Toggle theme on click
themeToggle.addEventListener("click", () => {
  document.body.classList.toggle("light");
  const isLight = document.body.classList.contains("light");
  themeToggle.textContent = isLight ? "‚òÄÔ∏è" : "üåô";
  localStorage.setItem("theme", isLight ? "light" : "dark");
});

// --- BLOG RENDERING LOGIC ---
function estimateReadingTime(text) {
  const wordsPerMinute = 200;
  return Math.ceil(text.trim().split(/\s+/).length / wordsPerMinute);
}

const params = new URLSearchParams(window.location.search);
const file = params.get("file");
const contentDiv = document.getElementById("blog-content");

if (file) {
  fetch(`./${file}`)
    .then((res) => {
      if (!res.ok) throw new Error("Failed to load file");
      return res.text();
    })
    .then((md) => {
      contentDiv.innerHTML = marked.parse(md);

      // Plain code blocks
      document.querySelectorAll("pre code").forEach((block) => {
        block.style.background = "transparent";
        block.style.color = "inherit";
      });

      // Dynamic meta info
      const meta = document.createElement("p");
      meta.className = "blog-meta";
      const today = new Date();
      const formattedDate = today.toLocaleDateString("en-US", {
        year: "numeric",
        month: "short",
        day: "numeric",
      });
      const minutes = estimateReadingTime(md);
      meta.textContent = `${formattedDate} ¬∑ ${minutes} min read`;
      contentDiv.prepend(meta);

      // Fade-in effect
      setTimeout(() => contentDiv.classList.add("visible"), 50);
    })
    .catch((err) => {
      contentDiv.innerHTML = "<p>Failed to load blog. Check file path.</p>";
      console.error(err);
    });
} else {
  contentDiv.innerHTML = "<p>No blog file specified.</p>";
}
</script>
</body>
</html>
