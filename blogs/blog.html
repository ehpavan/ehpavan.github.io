<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Blog | Pavan</title>
<link rel="stylesheet" href="style.css">
<script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
<style>
/* Plain code blocks */
pre, pre code {
  background-color: transparent;
  color: inherit;
  padding: 10px;
  border-radius: 5px;
  overflow-x: auto;
  display: block;
  font-family: monospace;
  white-space: pre-wrap;
  word-wrap: break-word;
}

/* Blog content (NO delayed animation) */
.blog-content {
  opacity: 1;
  transform: none;
}

/* Meta info */
.blog-meta {
  font-size: 0.95rem;
  color: #555;
  margin-bottom: 12px;
  font-style: normal;
  font-weight: 500;
}
</style>
</head>
<body>

<nav>
  <a href="index.html">← Back to Blogs</a>
</nav>

<div class="blog-content" id="blog-content">
  <h2>Loading blog...</h2>
</div>

<script>
function estimateReadingTime(text) {
  const wordsPerMinute = 200;
  return Math.ceil(text.trim().split(/\s+/).length / wordsPerMinute);
}

const params = new URLSearchParams(window.location.search);
const file = params.get('file');
const contentDiv = document.getElementById('blog-content');

async function loadBlog() {
  if (!file) {
    contentDiv.innerHTML = "<p>No blog file specified.</p>";
    return;
  }

  try {
    const res = await fetch(`./${file}`);
    if (!res.ok) throw new Error("Failed to load file");
    const md = await res.text();

    contentDiv.innerHTML = marked.parse(md);

    document.querySelectorAll("pre code").forEach(block => {
      block.style.background = "transparent";
      block.style.color = "inherit";
    });

    // Load correct published date
    let formattedDate = "Unknown date";
    try {
      const metaRes = await fetch("blogs.json");
      const blogs = await metaRes.json();
      const blog = blogs.find(b => b.file === file);
      if (blog?.date) {
        formattedDate = new Date(blog.date).toLocaleDateString(
          "en-US",
          { year: "numeric", month: "short", day: "numeric" }
        );
      }
    } catch {}

    const minutes = estimateReadingTime(md);

    const meta = document.createElement("p");
    meta.className = "blog-meta";
    meta.textContent = `${formattedDate} · ${minutes} min read`;
    contentDiv.prepend(meta);

  } catch (err) {
    contentDiv.innerHTML = "<p>Failed to load blog.</p>";
    console.error(err);
  }
}

loadBlog();
</script>

</body>
</html>
